---
kind: pipeline
type: exec
name: default

platform:
  os: darwin
  arch: amd64

steps:
- name: build
  environment:
    CEP_ID: com.aedt.adobe-ide
    CEP_NOTARIZE_USERNAME:
      from_secret: CEP_NOTARIZE_USERNAME
    CEP_NOTARIZE_APP_PASSWORD:
      from_secret: CEP_NOTARIZE_APP_PASSWORD
  commands:
    - ./ci.sh


kind: pipeline
type: exec
name: build-installers

steps:
- name: build
  environment:
    CEP_ID: com.aedt.adobe-ide
    CEP_NOTARIZE_USERNAME:
      from_secret: CEP_NOTARIZE_USERNAME
    CEP_NOTARIZE_APP_PASSWORD:
      from_secret: CEP_NOTARIZE_APP_PASSWORD
  commands:
    - ./ci.sh
- name: publish
  environment:
    GITHUB_API_KEY:
      from_secret: GITHUB_API_KEY
  commands:
    - export PATH=/usr/local/bin:$PATH
    - docker run --rm \
      -e DRONE_BUILD_EVENT=tag \
      -e DRONE_REPO_OWNER=adobe-extension-tools \
      -e DRONE_REPO_NAME=adobe-ide \
      -e DRONE_COMMIT_REF=refs/heads/master \
      -e PLUGIN_API_KEY=${GITHUB_API_KEY} \
      -e PLUGIN_FILES=master \
      -v $(pwd):$(pwd) \
      -w $(pwd) \
      plugins/github-release